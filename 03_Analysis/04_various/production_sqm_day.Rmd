---
title: "Production value"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

**Purpose**: Calculate production per sqm and day for both movement treatments (*rand* vs. *attr*) and all treatment levels.

```{r load_data, message = FALSE}
# load packages #
source(here::here("01_Helper_functions/setup.R"))

source(here::here("01_Helper_functions/calc_seagrass_values.R"))

sim_experiment <- readr::read_rds(here::here("02_Data/02_Modified/03_run_model/sim_experiment.rds"))

model_runs <- readr::read_rds(here::here("02_Data/02_Modified/03_run_model/model_runs.rds"))
```

This calculates the total production of all treatments levels (including repetitions). I took the mean of repetitions with the same treatment levels and divided the value by 100 x 100 cells and 50 years x 365 days to get production per sqm per day.

```{r calc_prod}
# add row id to sim_experiment
sim_experiment <- dplyr::mutate(sim_experiment, 
                                id = as.character(1:nrow(sim_experiment)), 
                                .before = "nutrients_pool")

# calculate total production rand/attr
rand_full <- purrr::map_dfr(model_runs, function(i) 
  magrittr::extract2(i, "rand") %>%
    magrittr::extract2("seafloor") %>% 
    calc_total_production(norm = FALSE), .id = "id") %>% 
  dplyr::left_join(sim_experiment, by = "id")

rand_treatment <- dplyr::group_by(rand_full, part, nutrients_pool, pop_n) %>% 
  dplyr::summarise(prod_mean = mean(value), .groups = "drop") %>% 
  dplyr::mutate(prod_sqm_day = prod_mean / (100 * 100) / (50 * 365)) %>% 
  dplyr::arrange(nutrients_pool, pop_n) %>% 
  dplyr::select(-prod_mean)

attr_full <- purrr::map_dfr(model_runs, function(i) 
  magrittr::extract2(i, "attr") %>%
    magrittr::extract2("seafloor") %>% 
    calc_total_production(norm = FALSE), .id = "id") %>% 
  dplyr::left_join(sim_experiment, by = "id")

attr_treatment <- dplyr::group_by(attr_full, part, nutrients_pool, pop_n) %>% 
  dplyr::summarise(prod_mean = mean(value), .groups = "drop") %>% 
  dplyr::mutate(prod_sqm_day = prod_mean / (100 * 100) / (50 * 365)) %>% 
  dplyr::arrange(nutrients_pool, pop_n) %>% 
  dplyr::select(-prod_mean)
```

Here are the results for *ag* and *bg* separated by movement type and treatment levels. You should be able to scroll down within the tables to see all values.

```{r results_rand, echo = FALSE}
knitr::kable(rand_treatment, caption = "Random movement") %>% 
  kableExtra::kable_styling() %>% 
  kableExtra::scroll_box(height = "350px")

```

<br>
<br>

```{r results_attr, echo = FALSE}
knitr::kable(attr_treatment, caption = "Attracted movement") %>% 
  kableExtra::kable_styling() %>% 
  kableExtra::scroll_box(height = "350px")
```

